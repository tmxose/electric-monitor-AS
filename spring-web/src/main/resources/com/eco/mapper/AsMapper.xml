<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eco.mapper.AsMapper">
	<!-- SELECT -->
	<!-- AS 신고내역 전체 조회 -->
	<select id="selectAllAsList" resultType="com.eco.domain.ASVO">
		<![CDATA[
		SELECT * FROM T_AS
		WHERE use_yn = 'Y'
		]]>
	</select>
	
	<select id="selectAsListByStaff"
		resultType="com.eco.domain.ASVO" parameterType="int">
        <![CDATA[
        SELECT * FROM T_AS
        WHERE staff_cd = #{staffCd}
        AND use_yn = 'Y'
        ]]>
	</select>
	<select id="selectAsListByUser"
		resultType="com.eco.domain.ASVO" parameterType="int">
        <![CDATA[
        SELECT * FROM T_AS
        WHERE user_cd = #{user_cd}
        AND use_yn = 'Y'
        ]]>
	</select>
	<!-- 신고 수정 화면 -->
	<select id="selectAsDetailByCommon" resultType="com.eco.domain.ASVO">
        <![CDATA[
        SELECT * FROM T_AS
        WHERE as_cd = #{as_cd}
        AND use_yn = 'Y'
        ]]>
	</select>


	<!-- INSERT -->
	<!-- 일반 회원의 AS 신고 -->
	<insert id="insertAsListByCommon" parameterType="com.eco.domain.ASVO">
        <![CDATA[
		    INSERT INTO t_as(staff_cd, user_cd, user_mail, as_title, as_content, as_date, as_addr, as_facility)
		    VALUES(5, #{user_cd}, #{user_mail}, #{as_title}, #{as_content}, #{as_date}, #{as_addr}, #{as_facility});
	    ]]>
	</insert>


	<!-- UPDATE -->
	<update id="updateAsListByCommon" parameterType="com.eco.domain.ASVO">
        <![CDATA[
		    UPDATE t_as set staff_cd=5, user_mail=#{user_mail}, as_title=#{as_title}, as_content=#{as_content}, as_date=#{as_date}, as_addr=#{as_addr}, as_facility=#{as_facility}
		    WHERE as_cd=#{as_cd}
	    ]]>
	</update>
	<!-- UPDATE -->
	<update id="deleteAsListByCommon" parameterType="com.eco.domain.ASVO">
        <![CDATA[
		    UPDATE t_as set use_yn="N"
		    WHERE as_cd=#{as_cd}
	    ]]>
	</update>
	
	<select id="selectAllAsDtoList"
		resultType="com.eco.domain.ASListDTO">
		<![CDATA[
		SELECT
		  A.as_cd,
		  A.as_title,
		  A.as_content,
		  A.as_date,
		  A.as_addr,
		  A.as_facility,
		  A.as_status,
		  A.user_cd,
		  U.user_id,
		  U.user_nm,
		  U.user_mail,
		  U.user_addr,
		  U.user_social,
		  A.staff_cd,
		  S.staff_id,
		  S.staff_nm,
		  S.staff_addr,
		  S.staff_role,
		  A.guest_mail,
		  A.guest_nm,
		  A.use_yn
		FROM t_as A
		LEFT JOIN t_user U ON A.user_cd = U.user_cd
		LEFT JOIN t_staff S ON A.staff_cd = S.staff_cd
		WHERE A.use_yn = 'Y'
		]]>
	</select>

	<select id="selectAsDtoListByStaff"
		resultType="com.eco.domain.ASListDTO" parameterType="int">
        <![CDATA[
        SELECT
		  A.as_cd,
		  A.as_title,
		  A.as_content,
		  A.as_date,
		  A.as_addr,
		  A.as_facility,
		  A.as_status,
		  A.user_cd,
		  U.user_id,
		  U.user_nm,
		  U.user_mail,
		  U.user_addr,
		  U.user_social,
		  A.staff_cd,
		  S.staff_id,
		  S.staff_nm,
		  S.staff_addr,
		  S.staff_role,
		  A.guest_mail,
		  A.guest_nm,
		  A.use_yn
		FROM T_AS A
		LEFT JOIN T_USER U ON A.user_cd = U.user_cd
		LEFT JOIN T_STAFF S ON A.staff_cd = S.staff_cd
		WHERE A.staff_cd = #{staffCd}
		  AND A.use_yn = 'Y'
        ]]>
	</select>
	<select id="selectAsDtoListByUser"
		resultType="com.eco.domain.ASVO" parameterType="int">
        <![CDATA[
        SELECT * FROM T_AS
        WHERE user_cd = #{user_cd}
        AND use_yn = 'Y'
        ]]>
	</select>

	<!-- 상세 조회 -->
	<select id="selectAsTask" resultType="com.eco.domain.ASListDTO"
		parameterType="int">
	    <![CDATA[
	    SELECT a.*, s.staff_nm, u.user_nm
	    FROM t_as a
	    LEFT JOIN t_staff s ON a.staff_cd = s.staff_cd
	    LEFT JOIN t_user u ON a.user_cd = u.user_cd
	    WHERE a.as_cd = #{asCd}
	    AND a.use_yn = 'Y'
	    ]]>
	</select>

   <!-- 사용자별 날짜별 AS 일정 조회 -->
    <select id="selectScheduleByUserAndDate" parameterType="map" resultType="com.eco.domain.ASVO">
        <![CDATA[
        SELECT *
        FROM T_AS
        WHERE user_cd = #{user_cd}
          AND DATE(as_date) = #{date}
        ORDER BY as_date
        ]]>
    </select>

    <!-- 직원별 날짜별 AS 일정 조회 -->
    <select id="selectScheduleByStaffAndDate" parameterType="map" resultType="com.eco.domain.ASVO">
        <![CDATA[
        SELECT *
        FROM T_AS
        WHERE staff_cd = #{staff_cd}
          AND DATE(as_date) = #{date}
        ORDER BY as_date
        ]]>
    </select>


	<!-- UPDATE -->
	<update id="updateStatusByCd">
	    <![CDATA[
	    UPDATE T_AS
	    SET as_status = #{as_status}
	    WHERE as_cd = #{as_cd}
	    ]]>
	</update>

</mapper>